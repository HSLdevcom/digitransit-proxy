#smoove citybike api (http://helsinki-fi.smoove.pro/api-public/stations)
location /out/helsinki-fi.smoove.pro/ {
  proxy_pass  http://helsinki-fi.smoove.pro/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#turku smoove citybike api (http://data.foli.fi/citybike/smoove)
location /out/data.foli.fi/ {
  proxy_pass  http://data.foli.fi/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#hsl park api https://p.hsl.fi/api/v1/facilities.json?limit=-1
location /out/p.hsl.fi/ {
  proxy_pass  https://p.hsl.fi/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#hsl test park api https://test.liipi.hsldev.com/api/v1/facilities.json?limit=-1
location /out/test.liipi.hsldev.com/ {
  proxy_pass  https://test.liipi.hsldev.com/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#oulu realtime api (http://92.62.36.215/RTIX/trip-update)
location /out/92.62.36.215/ {
  proxy_pass    http://92.62.36.215/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#new livi gtfs rt (https://tyokalu.navici.com/joukkoliikenne/manual-gtfsrt/api/gtfsrt/alerts)
location /out/tyokalu.navici.com/ {
  proxy_pass    https://tyokalu.navici.com/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#kuopio gtfs rt (https://vilkku.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate)
location /out/vilkku.mattersoft.fi/ {
  proxy_pass    https://vilkku.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization VILKKU_BASIC_AUTH;
}

#joensuu gtfs rt (https://jojo.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate)
location /out/jojo.mattersoft.fi/ {
  proxy_pass    https://jojo.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization JOJO_BASIC_AUTH;
}

#lappeenranta gtfs rt (https://lappeenranta.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate)
location /out/lappeenranta.mattersoft.fi/ {
  proxy_pass    https://lappeenranta.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization LAPPEENRANTA_BASIC_AUTH;
}

#jyvaskyla gtfs rt (https://linkki.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate)
location /out/linkki.mattersoft.fi/ {
  proxy_pass    https://linkki.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization LINKKI_BASIC_AUTH;
}

#varely (seutuplus) gtfs (https://varelyadmin.mattersoft.fi/feeds/102.zip)
location /out/varelyadmin.mattersoft.fi/ {
  proxy_pass    https://varelyadmin.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization VARELY_BASIC_AUTH;
}

#tampere gtfs rt new (https://tre.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealerts and vehiclepositions)
location /out/tre.mattersoft.fi/ {
  proxy_pass    https://tre.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization NEW_LISSU_BASIC_AUTH;
}

#lmj gtfs rt new (https://lmj.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealerts and vehiclepositions)
location /out/lmj.mattersoft.fi/ {
  proxy_pass    https://lmj.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization LMJ_BASIC_AUTH;
}

#lahti gtfs rt  (https://lsl.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/lsl.mattersoft.fi/ {
  proxy_pass    https://lsl.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization LAHTI_BASIC_AUTH;
}

#Vilkku (Kuopio) bike stations (https://kaupunkipyorat.kuopio.fi/tkhs-export-map.html?format=xml)
location /out/kaupunkipyorat.kuopio.fi/ {
  proxy_pass    https://kaupunkipyorat.kuopio.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid any 60s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
}

#hameenlinna gtfs rt  (https://hameenlinna.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/hameenlinna.mattersoft.fi/ {
  proxy_pass    https://hameenlinna.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization HAMEENLINNA_BASIC_AUTH;
}

#mikkeli gtfs rt  (https://mikkeli.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/mikkeli.mattersoft.fi/ {
  proxy_pass    https://mikkeli.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization MIKKELI_BASIC_AUTH;
}

#vaasa gtfs rt  (https://lifti.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/lifti.mattersoft.fi/ {
  proxy_pass    https://lifti.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization VAASA_BASIC_AUTH;
}

#salo gtfs rt  (https://paikku.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/paikku.mattersoft.fi/ {
  proxy_pass    https://paikku.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization SALO_BASIC_AUTH;
}

#kouvola gtfs rt  (https://koutsi.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/koutsi.mattersoft.fi/ {
  proxy_pass    https://koutsi.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization KOUVOLA_BASIC_AUTH;
}

#kotka gtfs rt  (https://jonnejaminne.mattersoft.fi/api/gtfsrealtime/v1.0/feed/tripupdate, servicealert and vehicleposition)
location /out/jonnejaminne.mattersoft.fi/ {
  proxy_pass    https://jonnejaminne.mattersoft.fi/;
  include allowed-ips.conf;
  proxy_cache   ext_cache;
  proxy_cache_valid 200 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_set_header Authorization KOTKA_BASIC_AUTH;
}

#perille gtfs
location /out/gtfs.perille.fi/ {
  proxy_pass    https://gtfs.perille.fi/;
  include allowed-ips.conf;
  proxy_set_header Authorization PERILLE_BASIC_AUTH;
}

#donkey citybike api (for example https://stables.donkey.bike/api/public/gbfs/2/donkey_lappeenranta/gbfs.json)
location /out/stables.donkey.bike/ {
  proxy_pass  https://stables.donkey.bike/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid any 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  proxy_ssl_server_name on;
}

#giravolta (seatcode) citybike api for tampere
#for example https://tampere-api.giravolta.io/api-opendata/gbfs/2_3/system_information get sent to
#https://api.giravolta.io/api-opendata/gbfs/2_3/system_information with correct authentication header
#replace urls in the discovery call with proxy address
location = /out/tampere-api.giravolta.io/api-opendata/gbfs/2_3/gbfs {
  proxy_pass  https://api.giravolta.io/api-opendata/gbfs/2_3/gbfs;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid any 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  #Default caching would use the $proxy_host so we need custom rule to use request host
  proxy_cache_key $scheme$host$request_uri;
  proxy_set_header Authorization GIRAVOLTA_TAMPERE_AUTH;
  sub_filter 'https://api.giravolta.io' 'http://digitransit-proxy:8080/out/tampere-api.giravolta.io';
  sub_filter_once off;
  sub_filter_types *;
}

#giravolta api calls for tampere
location /out/tampere-api.giravolta.io/ {
  proxy_pass  https://api.giravolta.io/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid any 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  #Default caching would use the $proxy_host so we need custom rule to use request host
  proxy_cache_key $scheme$host$request_uri;
  proxy_set_header Authorization GIRAVOLTA_TAMPERE_AUTH;
}


#giravolta (seatcode) citybike api for vantaa
#for example https://vantaa-api.giravolta.io/api-opendata/gbfs/2_3/system_information get sent to
#https://api.giravolta.io/api-opendata/gbfs/2_3/system_information with correct authentication header
#replace urls in the discovery call with proxy address
location = /out/vantaa-api.giravolta.io/api-opendata/gbfs/2_3/gbfs {
  proxy_pass  https://api.giravolta.io/api-opendata/gbfs/2_3/gbfs;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid any 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  #Default caching would use the $proxy_host so we need custom rule to use request host
  proxy_cache_key $scheme$host$request_uri;
  proxy_set_header Authorization GIRAVOLTA_VANTAA_AUTH;
  sub_filter 'https://api.giravolta.io' 'http://digitransit-proxy:8080/out/vantaa-api.giravolta.io';
  sub_filter_once off;
  sub_filter_types *;
}

#giravolta api calls for vantaa
location /out/vantaa-api.giravolta.io/ {
  proxy_pass  https://api.giravolta.io/;
  include allowed-ips.conf;
  proxy_cache ext_cache;
  proxy_cache_valid any 30s;
  proxy_cache_lock on;
  add_header X-Proxy-Cache $upstream_cache_status;
  proxy_ignore_headers X-Accel-Expires Expires Cache-Control Set-Cookie;
  proxy_cache_use_stale error timeout http_500 http_502 http_503 http_504;
  #Default caching would use the $proxy_host so we need custom rule to use request host
  proxy_cache_key $scheme$host$request_uri;
  proxy_set_header Authorization GIRAVOLTA_VANTAA_AUTH;
}
